<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”® ìš´ì„¸ DApp - ë¸”ë¡ì²´ì¸ ì ì„±ìˆ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #ffd700;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .fortune-result {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 20px;
            margin-top: 20px;
            display: none;
        }

        .fortune-result h3 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .fortune-message {
            font-size: 1.3em;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .lucky-number {
            font-size: 3em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .status.success {
            background: rgba(46, 204, 113, 0.3);
            border: 1px solid #2ecc71;
        }

        .status.error {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
        }

        .zodiac-select {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
        }

        .zodiac-select option {
            background: #333;
            color: white;
        }

        .admin-section {
            border-top: 2px solid rgba(255, 215, 0, 0.3);
            padding-top: 30px;
            margin-top: 30px;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0,0,0,0.3);
            font-size: 14px;
        }

        .connected {
            background: rgba(46, 204, 113, 0.3) !important;
            border: 1px solid #2ecc71;
        }

        .disconnected {
            background: rgba(231, 76, 60, 0.3) !important;
            border: 1px solid #e74c3c;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        ğŸ”— ì—°ê²° í™•ì¸ ì¤‘...
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ”® ìš´ì„¸ DApp</h1>
            <p>ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ì‹ ë¹„ë¡œìš´ ì ì„±ìˆ  ì„œë¹„ìŠ¤</p>
        </div>

        <div id="statusMessage" class="status"></div>

        <!-- ì‚¬ìš©ì ë“±ë¡ ì„¹ì…˜ -->
        <div class="card" id="registerSection">
            <h2>âœ¨ ì‚¬ìš©ì ë“±ë¡</h2>
            <div class="form-group">
                <label for="userName">ì´ë¦„</label>
                <input type="text" id="userName" placeholder="ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="form-group">
                <label for="birthDate">ìƒë…„ì›”ì¼</label>
                <input type="text" id="birthDate" placeholder="YYYYMMDD (ì˜ˆ: 19950315)">
            </div>
            <div class="form-group">
                <label for="zodiacSign">ë³„ìë¦¬</label>
                <select id="zodiacSign" class="zodiac-select">
                    <option value="">ë³„ìë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="Aries">ì–‘ìë¦¬ (Aries)</option>
                    <option value="Taurus">í™©ì†Œìë¦¬ (Taurus)</option>
                    <option value="Gemini">ìŒë‘¥ì´ìë¦¬ (Gemini)</option>
                    <option value="Cancer">ê²Œìë¦¬ (Cancer)</option>
                    <option value="Leo">ì‚¬ììë¦¬ (Leo)</option>
                    <option value="Virgo">ì²˜ë…€ìë¦¬ (Virgo)</option>
                    <option value="Libra">ì²œì¹­ìë¦¬ (Libra)</option>
                    <option value="Scorpio">ì „ê°ˆìë¦¬ (Scorpio)</option>
                    <option value="Sagittarius">ì‚¬ìˆ˜ìë¦¬ (Sagittarius)</option>
                    <option value="Capricorn">ì—¼ì†Œìë¦¬ (Capricorn)</option>
                    <option value="Aquarius">ë¬¼ë³‘ìë¦¬ (Aquarius)</option>
                    <option value="Pisces">ë¬¼ê³ ê¸°ìë¦¬ (Pisces)</option>
                </select>
            </div>
            <button class="btn" onclick="registerUser()">ğŸŒŸ ë“±ë¡í•˜ê¸°</button>
        </div>

        <!-- ìš´ì„¸ ìƒì„± ì„¹ì…˜ -->
        <div class="card" id="fortuneSection" style="display: none;">
            <h2>ğŸ¯ ì˜¤ëŠ˜ì˜ ìš´ì„¸</h2>
            <button class="btn" onclick="generateFortune()">ğŸ”® ìš´ì„¸ ë³´ê¸°</button>
            <button class="btn" onclick="checkTodaysFortune()" style="background: linear-gradient(45deg, #74b9ff, #0984e3);">ğŸ“– ê¸°ì¡´ ìš´ì„¸ í™•ì¸</button>
            
            <div id="fortuneResult" class="fortune-result">
                <h3>ğŸŒŸ ë‹¹ì‹ ì˜ ìš´ì„¸</h3>
                <div id="fortuneMessage" class="fortune-message"></div>
                <div>í–‰ìš´ì˜ ìˆ«ì: <span id="luckyNumber" class="lucky-number"></span></div>
                <div style="margin-top: 15px;">ë³„ìë¦¬: <span id="userZodiac"></span></div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì ì„¹ì…˜ -->
        <div class="card admin-section" id="adminSection" style="display: none;">
            <h2>ğŸ‘‘ ê´€ë¦¬ì ê¸°ëŠ¥</h2>
            <div class="form-group">
                <label for="newMessage">ìƒˆë¡œìš´ ìš´ì„¸ ë©”ì‹œì§€</label>
                <input type="text" id="newMessage" placeholder="ìƒˆë¡œìš´ ìš´ì„¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <button class="btn" onclick="addFortuneMessage()">ğŸ’« ë©”ì‹œì§€ ì¶”ê°€</button>
            <button class="btn" onclick="getAllMessages()" style="background: linear-gradient(45deg, #a29bfe, #6c5ce7);">ğŸ“‹ ëª¨ë“  ë©”ì‹œì§€ ë³´ê¸°</button>
        </div>
    </div>

    <!-- Web3 ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    
    <script>
        console.log("ğŸ”® ìš´ì„¸ DApp ë¡œë“œ ì™„ë£Œ!");
        // ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì„¤ì •
        let web3;
        let contract;
        let userAccount;

        // ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œì™€ ABI (Remixì—ì„œ ë³µì‚¬í•´ì˜¬ ì˜ˆì •)
        const CONTRACT_ADDRESS = "0x1e70fDd1560a4CC51aabE462EA69c15b30337f2B"; // ì‹¤ì œ ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œ
        const CONTRACT_ABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_admin",
                        "type": "address"
                    }
                ],
                "name": "addAdmin",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "_message",
                        "type": "string"
                    }
                ],
                "name": "addFortuneMessage",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "admin",
                        "type": "address"
                    }
                ],
                "name": "AdminAdded",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "date",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "message",
                        "type": "string"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "luckyNumber",
                        "type": "uint256"
                    }
                ],
                "name": "FortuneGenerated",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "generateTodaysFortune",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "message",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "luckyNumber",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "string",
                        "name": "_name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "_birthDate",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "_zodiacSign",
                        "type": "string"
                    }
                ],
                "name": "registerUser",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_admin",
                        "type": "address"
                    }
                ],
                "name": "removeAdmin",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_index",
                        "type": "uint256"
                    }
                ],
                "name": "removeFortuneMessage",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_index",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "_newMessage",
                        "type": "string"
                    }
                ],
                "name": "updateFortuneMessage",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    }
                ],
                "name": "UserRegistered",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "admins",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "fortuneMessages",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getAllFortuneMessages",
                "outputs": [
                    {
                        "internalType": "string[]",
                        "name": "",
                        "type": "string[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getContractInfo",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "contractOwner",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "totalFortuneMessages",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "currentDate",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getCurrentDate",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_date",
                        "type": "uint256"
                    }
                ],
                "name": "getFortune",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "message",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "luckyNumber",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "date",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "exists",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "_index",
                        "type": "uint256"
                    }
                ],
                "name": "getFortuneMessage",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getFortuneMessageCount",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getMyInfo",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "birthDate",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "isRegistered",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getTodaysFortune",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "message",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "luckyNumber",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "exists",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_user",
                        "type": "address"
                    }
                ],
                "name": "getUserInfo",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "birthDate",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "isRegistered",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_user",
                        "type": "address"
                    }
                ],
                "name": "isUserRegistered",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "name": "userFortunes",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "message",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "luckyNumber",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "date",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "exists",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "users",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "birthDate",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "zodiacSign",
                        "type": "string"
                    },
                    {
                        "internalType": "bool",
                        "name": "isRegistered",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ]

        // Web3 ì´ˆê¸°í™”
        async function initWeb3() {
            if (typeof window.ethereum !== 'undefined') {
                web3 = new Web3(window.ethereum);
                try {
                    // MetaMask ì—°ê²° ìš”ì²­
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    
                    // ì»¨íŠ¸ë™íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    updateConnectionStatus(true);
                    checkUserRegistration();
                    checkAdminStatus();
                    
                } catch (error) {
                    console.error("MetaMask ì—°ê²° ì‹¤íŒ¨:", error);
                    updateConnectionStatus(false);
                }
            } else {
                alert("MetaMaskê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
                updateConnectionStatus(false);
            }
        }

        // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.textContent = `ğŸŸ¢ ì—°ê²°ë¨: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                status.className = 'connection-status connected';
            } else {
                status.textContent = 'ğŸ”´ ì—°ê²° ì•ˆë¨';
                status.className = 'connection-status disconnected';
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // ì‚¬ìš©ì ë“±ë¡ í™•ì¸
        async function checkUserRegistration() {
            try {
                const isRegistered = await contract.methods.isUserRegistered(userAccount).call();
                
                if (isRegistered) {
                    document.getElementById('registerSection').style.display = 'none';
                    document.getElementById('fortuneSection').style.display = 'block';
                    
                    // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    const userInfo = await contract.methods.getMyInfo().call({ from: userAccount });
                    showStatus(`í™˜ì˜í•©ë‹ˆë‹¤, ${userInfo.name}ë‹˜! (${userInfo.zodiacSign})`, 'success');
                } else {
                    document.getElementById('registerSection').style.display = 'block';
                    document.getElementById('fortuneSection').style.display = 'none';
                }
            } catch (error) {
                console.error("ì‚¬ìš©ì ë“±ë¡ í™•ì¸ ì‹¤íŒ¨:", error);
            }
        }

        // ê´€ë¦¬ì ìƒíƒœ í™•ì¸
        async function checkAdminStatus() {
            try {
                const isAdmin = await contract.methods.admins(userAccount).call();
                if (isAdmin) {
                    document.getElementById('adminSection').style.display = 'block';
                }
            } catch (error) {
                console.error("ê´€ë¦¬ì ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:", error);
            }
        }

        // ì‚¬ìš©ì ë“±ë¡
        async function registerUser() {
            const name = document.getElementById('userName').value;
            const birthDate = document.getElementById('birthDate').value;
            const zodiacSign = document.getElementById('zodiacSign').value;
            
            if (!name || !birthDate || !zodiacSign) {
                showStatus('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            try {
                showStatus('ë“±ë¡ ì¤‘...', 'success');
                
                await contract.methods.registerUser(name, parseInt(birthDate), zodiacSign)
                    .send({ from: userAccount });
                
                showStatus('ë“±ë¡ ì™„ë£Œ!', 'success');
                checkUserRegistration();
                
            } catch (error) {
                console.error("ë“±ë¡ ì‹¤íŒ¨:", error);
                showStatus('ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ìš´ì„¸ ìƒì„±
        async function generateFortune() {
            try {
                showStatus('ìš´ì„¸ ìƒì„± ì¤‘...', 'success');
                
                const result = await contract.methods.generateTodaysFortune()
                    .send({ from: userAccount });
                
                // ì´ë²¤íŠ¸ì—ì„œ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
                const fortuneEvent = result.events.FortuneGenerated;
                if (fortuneEvent) {
                    displayFortune(
                        fortuneEvent.returnValues.message,
                        fortuneEvent.returnValues.luckyNumber,
                        "ë‹¹ì‹ ì˜ ë³„ìë¦¬"
                    );
                }
                
                showStatus('ìƒˆë¡œìš´ ìš´ì„¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error("ìš´ì„¸ ìƒì„± ì‹¤íŒ¨:", error);
                if (error.message.includes("already generated")) {
                    showStatus('ì˜¤ëŠ˜ ì´ë¯¸ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì…¨ìŠµë‹ˆë‹¤!', 'error');
                } else {
                    showStatus('ìš´ì„¸ ìƒì„± ì‹¤íŒ¨: ' + error.message, 'error');
                }
            }
        }

        // ì˜¤ëŠ˜ì˜ ìš´ì„¸ í™•ì¸
        async function checkTodaysFortune() {
            try {
                const fortune = await contract.methods.getTodaysFortune().call({ from: userAccount });
                
                if (fortune.exists) {
                    displayFortune(fortune.message, fortune.luckyNumber, fortune.zodiacSign);
                    showStatus('ê¸°ì¡´ ìš´ì„¸ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!', 'success');
                } else {
                    showStatus('ì•„ì§ ì˜¤ëŠ˜ì˜ ìš´ì„¸ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•´ì£¼ì„¸ìš”!', 'error');
                }
                
            } catch (error) {
                console.error("ìš´ì„¸ ì¡°íšŒ ì‹¤íŒ¨:", error);
                showStatus('ìš´ì„¸ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ìš´ì„¸ ê²°ê³¼ í‘œì‹œ
        function displayFortune(message, luckyNumber, zodiacSign) {
            document.getElementById('fortuneMessage').textContent = message;
            document.getElementById('luckyNumber').textContent = luckyNumber;
            document.getElementById('userZodiac').textContent = zodiacSign;
            document.getElementById('fortuneResult').style.display = 'block';
        }

        // ìš´ì„¸ ë©”ì‹œì§€ ì¶”ê°€ (ê´€ë¦¬ì)
        async function addFortuneMessage() {
            const message = document.getElementById('newMessage').value;
            
            if (!message) {
                showStatus('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }
            
            try {
                showStatus('ë©”ì‹œì§€ ì¶”ê°€ ì¤‘...', 'success');
                
                await contract.methods.addFortuneMessage(message)
                    .send({ from: userAccount });
                
                showStatus('ìƒˆë¡œìš´ ìš´ì„¸ ë©”ì‹œì§€ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                document.getElementById('newMessage').value = '';
                
            } catch (error) {
                console.error("ë©”ì‹œì§€ ì¶”ê°€ ì‹¤íŒ¨:", error);
                showStatus('ë©”ì‹œì§€ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // ëª¨ë“  ìš´ì„¸ ë©”ì‹œì§€ ì¡°íšŒ
        async function getAllMessages() {
            try {
                const messages = await contract.methods.getAllFortuneMessages().call();
                alert("ëª¨ë“  ìš´ì„¸ ë©”ì‹œì§€:\n\n" + messages.join("\n\n"));
            } catch (error) {
                console.error("ë©”ì‹œì§€ ì¡°íšŒ ì‹¤íŒ¨:", error);
                showStatus('ë©”ì‹œì§€ ì¡°íšŒ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            console.log("ğŸ”® ìš´ì„¸ DApp ì´ˆê¸°í™” ì¤‘...");
            initWeb3(); // ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œì™€ ABI ì„¤ì • í›„ ì£¼ì„ í•´ì œ
        });

    </script>
</body>
</html>
